<!DOCTYPE html>
<html>
	<head>
		<title>Matsui</title>
		<meta charset="utf8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wdth,wght,YTLC@0,6..12,75..125,200..1000,440..540;1,6..12,75..125,200..1000,440..540&family=Noto+Sans+Mono:wdth,wght@90,380..500&display=swap">
		<style>
			* {
				box-sizing: border-box;
			}
			body {
				font-family: "Nunito Sans", Geneva, Arial, sans-serif;
				font-optical-sizing: auto;
				font-weight: 400;/*200-1000*/
				font-style: normal;
				font-variation-settings:
					"wdth" 100/*75-125*/,
					"YTLC" 520/*440-540*/;
				font-size: 12pt;
				line-height: 1.4;
			
				margin: 0;
				padding: 0;
				color: #000;
				background: #F9F8F6;
			}
			pre {
				font-size: calc(min(0.85em, 2.6vw));
			}
			pre, code {
				font-family: "Noto Sans Mono", Monaco, Consolas, monospace;
				font-style: normal;
				font-optical-sizing: auto;
				font-weight: 500;
				font-style: normal;
				font-variation-settings:
					"wdth" 90;
				tab-size: 4;
			}
			pre code {
				font-weight: 380;
			}
			code:not([class*=language-]) {
				display: inline-block;
				color: #820;
			}
			p {
				margin: 0;
				padding: 0.5em 0;
			}
			p:first-child {
				margin-top: 0;
			}
			select, button {
				box-shadow: 0px 0.2em 0.1em -0.1em #0002;
				background: var(--hover-bg, none), linear-gradient(#FFF, #F8F8F8 70%, #EEE);
			}
			select:hover, button:hover {
				--hover-bg: linear-gradient(#FFF, #DDD);
				cursor: pointer;
			}
			input, button:active {
				box-shadow: 0px 0.2em 0.1em -0.1em #0002 inset;
				background: linear-gradient(#EEE, #F8F8F8 30%, #FFF);
			}
			select {
				appearance: none;
				-webkit-appearance: none;
				-moz-appearance: none;
				/* `data:image/svg+xml;base64,${btoa('<?xml version="1.0" encoding="utf-8"?>'+document.rootElement.outerHTML)}` */
				background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmVyc2lvbj0iMS4xIj48c3ZnIHZpZXdCb3g9Ii0yIC0yIDEzIDEzIiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWF4WU1pZCI+PHBhdGggZmlsbD0iIzg4OEQiIGQ9Ik0zIDMgNyAzIDUgNloiLz48L3N2Zz48L3N2Zz4=), var(--hover-bg, none), linear-gradient(#FFF, #F8F8F8 70%, #EEE);
			}
			select, input, button {
				padding: 0.2em 0.5em;
				text-align: center;
				text-align-last: center;

				border: 1px solid #888;
				border-radius: 0.25rem;

				font: inherit;
				font-size: 0.9em;
				color: inherit;
			}
			a[href], select {
				font-weight: 400;
				/*color: #64a3d9;*/
				color: #48B;
			}
			body > * {
				width: 100%;
				margin: none;
				box-sizing: border-box;
				padding: 0.2em calc(max(0.5rem, 50% - 300pt));
			}
			hgroup, h1, h2, h3, h4, h5, h6, select {
				font-family: "Nunito Sans", "Avant Garde", Avantgarde, "Century Gothic", Geneva, "Trebuchet MS", sans-serif;
				text-align: center;
				margin: 0.1em;
				font-weight: 600;
				font-variation-settings:
					"wdth" 103/*75-125*/,
					"YTLC" 440/*440-540*/;
			}
			h1 {
				font-size: 3.2em;
				font-weight: 200;
			}
			h2 {
				font-family: "Nunito Sans", "Arial Narrow", "Trebuchet MS", sans-serif;
				font-size: 2.2em;
				font-weight: 350;
				font-variation-settings:
					"wdth" 85/*75-125*/,
					"YTLC" 540/*440-540*/;
			}
			h3 {
				font-size: 1.4em;
				font-weight: 200;
			}
			h4, h5, h6 {
				text-align: start;
				font-size: 1.25em;
				font-variation-settings:
					"wdth" 95/*75-125*/,
					"YTLC" 540/*440-540*/;
				font-weight: 550;
			}
			h5 {
				font-weight: 300;
				font-variation-settings:
					"wdth" 100/*75-125*/,
					"YTLC" 440/*440-540*/;
				font-style: italic;
			}
			h6 {
				font-size: 0.9em;
				font-weight: 400;
				font-variation-settings:
					"wdth" 120/*75-125*/,
					"YTLC" 440/*440-540*/;
				font-style: italic;
				opacity: 0.85;
			}
			#ricky {
				float: right;
				height: 4rem;
				width: 4rem;
				margin: -4.5rem 0.25em 0 0;
				border-radius: 5px;
			}
			.stripe {
				background: var(--stripe-color, #345);
				background: linear-gradient(#FFF2, #FFF1 10%, #0000 25%, #0006), var(--stripe-color, #345);
				box-shadow: 0px 0.1rem 0.5rem #0005 inset, 0px 0.15rem 0.1rem #0003 inset;
				color: #FFF;
				font-weight: 320; /* thinner because it's white-on-dark text */
				text-shadow: 0 0.2ex #0004;
			}
			.columns {
				display: flex;
				flex-direction: row;
				flex-wrap: wrap;
				justify-content: space-around;
				gap: 1em;
			}
			.columns > * {
				flex-basis: 13rem;
				flex-grow: 0.3;
			}
			.columns h3 {
				border-bottom: 1px solid currentcolor;
			}

			.example {
				border: 1px solid #888;
				border-radius: 0.25rem;

				position: relative;
				display: flex;
				flex-direction: row;
				flex-wrap: wrap;
				align-items: stretch;
				justify-content: stretch;
				box-sizing: border-box;
				margin: 1rem 0.5rem;
				background: #FFF;
				color: #000;
				text-shadow: none;
			}
			.example > * {
				flex-grow: 1;
				border: 1px solid #888;
				padding: 0.25em;
				margin: -1px;
			}
			#example-select {
				display: block;
				width: 100%;
				margin-right: 3.8em;
				height: 2.6em;

				font: inherit;
				font-size: 0.95em;
				font-variation-settings:
					"wdth" 110/*75-125*/,
					"YTLC" 540/*440-540*/;
			}
			.example-desc {
				border-top: none;
				width: 100%;
				padding: 0.5em 0.8em;
				font-size: 0.95em;
				font-style: normal;
			}
			.example-html, .example-js {
				position: relative;
				flex-basis: 40ch;
				padding: 0.5em 0.8em;
				text-align: left;
			}
			.example-html::before, .example-js::before {
				position: absolute;
				top: 0;
				right: 0.3em;
				font-size: 0.65em;
				content: 'HTML';
				color: #666;
			}
			.example-js::before {
				content: 'JS';
			}
			.example-html {
				background: #F6F6F6;
			}
			.example-js {
				background: #F0F6FC;
			}
			.example-result {
				border: none;
				width: 100%;
				padding: 0.8em;
				text-align: left;
			}
			#link-to-example {
				position: absolute;
				top: 0;
				right: 0.5em;
				text-decoration: none;
				font-size: 1.5em;
				color: #888A;
				transform: rotate(180deg);
			}
		</style>
	</head>
	<body>
		<hgroup>
			<h1>Matsui</h1>
			<img src="doc/Ricky_Matsui.png" id="ricky">
			<p>Powerful.  Good-looking.  Straightforward.</p>
		</hgroup>
		
		<section id="features" class="stripe">
			<h2>Features</h2>

			<div class="columns">
				<div>
					<h3>JSON-like data</h3>
					<p>Templates read/write data as normal, and all changes are represented as <a href="https://www.rfc-editor.org/rfc/rfc7386.html">merge values</a>.</p>
				</div>
				<div>
					<h3>Quick prototyping</h3>
					<p>The HTML template syntax is simple and extendable, or you can write more complex templates directly in JavaScript.</p>
				</div>
				<div>
					<h3>Smart updates</h3>
					<p>Templates (even custom JS ones) directly update the DOM, but only when the relevant data changes.</p>
				</div>
				<div>
					<h3>Lightweight</h3>
					<p>The core Matsui library is <strong>5.5kB</strong> gzipped, and the bundle is <strong>8kB</strong> gzipped.</p>
				</div>
				<div>
					<h3>No compilation</h3>
					<p>No transpiling or special tools - it's all just JavaScript (ES6) which you can use in static sites or local files.</p>
				</div>
				<div>
					<h3>CSP support</h3>
					<p>Matsui can be used with a <a href="https://content-security-policy.com/">Content Security Policy</a>.  It's easy to convert inline HTML templates to CSP-friendly equivalents.</p>
				</div>
			</div>
		</section>
		<section id="examples">
			<h2>Quick-start guide</h2>
			
			<div class="example">
				<select id="example-select" $value="exampleName">
					<optgroup @foreach="{groups}" $label="{label}">
						<option @foreach="{examples}" $-value="{name}" $selected="{selected}">{name}</option>
					</optgroup>
				</select>
				<template @foreach="{groups}">
					<template @foreach="{examples}">
						<template @if="{selected}">
							<div class="example-desc">
								<a id="link-to-example" $href="#${d => Matsui.makeHash(null, {example: d.name}).hash}" title="share this example">#â†©</a>
								$html{desc}
							</div>
							<script>
								function runExample(data, node) {
									Matsui.access.pierce(data); // so we get updates
									node.innerHTML = data.html;
									let elementMap = data.elements || {};
									let args = Object.keys(elementMap);
									let elements = args.map(q => node.querySelector(elementMap[q]));
									if (!('node' in elementMap)) {
										args.push('node');
										elements.push(node);
									}
									let fn = new Function(...args, data.js);
									fn(...elements);
								}
							</script>
							<pre @if="{html}" class="example-html language-html">$prism-code{html}</pre>
							<pre @if="{js}" class="example-js language-js">$prism-code{js}</pre>
							<div @if="{js}" class="example-result"><div $update="${runExample}"></div></div>
						</template>
					</template>
				</template>
			</div>
		</section>
		<section id="design" class="stripe" style="--stripe-color: #353; --stripe-color:#5C534A">
			<h2>Under the hood</h2>
			
			<p>Matsui is best understood in layers:</p>
		</section>

		<script src="release/latest/matsui-bundle.min.js"></script>
		<style>
			/* for the examples */
			
			blockquote {
				margin-left: 1.25em;
				padding-left: 1.25em;
				border-left: 2px solid #8884;
				font-style: italic;
			}
			
			#change-list {
				border: 1px solid #DDD;
				border-radius: 0.3em;
				background: linear-gradient(0deg, #FFF, #FFF 4.7em, #0002);
				height: 5em;
				overflow: auto;
				scroll-behavior: smooth;
			}
			
			.hulk {
				font-size: 3em;
				filter: contrast(0.2) sepia(1) hue-rotate(45deg) saturate(2);
				-webkit-filter: contrast(0.2) sepia(1) hue-rotate(45deg) saturate(2);
			}
		</style>
		<script>
			// Lets us fill out raw HTML from the description
			Matsui.global.add('html', inner => {
				let node = document.createElement('span');
				return {
					node: node,
					updates: [data => {
						node.innerHTML = data;
					}]
				};
			});
			Matsui.global.attributes['update'] = (node, handler) => {
				return data => handler(node);
			};
			function unindent(text) {
				let lines = text.split('\n').filter(x => x.trim());
				let indent = '';
				while (/\s/.test(lines[0][indent.length])) {
					let nextIndent = indent + lines[0][indent.length];
					if (lines.some(line => line.substr(0, nextIndent.length) != nextIndent)) break;
					indent = nextIndent;
				}
				return text.split('\n' + indent).join('\n').trim();
			}
			Matsui.global.add('prism-code', inner => {
				let node = document.createElement('code');
				return {
					node: node,
					updates: [data => {
						node.textContent = unindent(data + "");
						if (window.Prism) window.Prism.highlightElement(node);
					}]
				};
			});

			let render = Matsui.replace(document.body, {
				groups: [
					{
						label: 'Overview',
						examples: [
							{
								name: 'HTML templates',
								desc: `
									<h4>Expressions</h4>
									<p>You can substitute properties with <code>{brackets}</code> or <code>{dot.separated.properties}</code> or function expressions with <code>\${data => ...}</code>.</p>
									<p>Expressions within the content are rendered as sub-templates.  The fallback template shows simple types as strings.</p>
									<h4>Attributes</h4>
									<p>Attributes starting with <code>$</code> are handled dynamically with the same <code>{...}</code>/<code>\${...}</code> syntax.  You can give attributes special behaviour (e.g. <code>$value</code> uses the attribute value as a key if it's a plain string), or it will use the attribute value as an <strong>event handler</strong>, <strong>JS DOM property</strong> or <strong>HTML attribute</strong> (in that order of preference).</p>
								`,
								html: `
									<blockquote>
										Hello, {name}!<br>
										HELLO \${d => d.name.toUpperCase()}!
									</blockquote>

									What's your name?<br>
									<input $value="name">
									<button $press="\${d => d.name = ''}">clear</button>
								`,
								js: `
									Matsui.replace(node, {
										name: 'world'
									});
								`
							},
							{
								name: 'JS template literals (CSP-compatible)',
								desc: `
									<p>Since a <a href="https://content-security-policy.com/">Content Security Policy</a> can prevent dynamic JavaScript evaluation (needed to pull <code>\${...}</code> expressions out of HTML), you can move your template into a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#tagged_templates">tagged template literal</a>.</p>
									<p>This makes it easy to convert an inline HTML template into a separate one, if you enable CSP later.</p>
								`,
								js: `
									let template = Matsui.global.fromTag\`
										<blockquote>
											Hello, {name}!<br>
											HELLO \${d => d.name.toUpperCase()}!
										</blockquote>

										What's your name?<br>
										<input $value="name">
										<button $press="\${d => d.name = ''}">clear</button>
									\`;

									Matsui.replace(node, {name: 'world'}, template);
								`
							},
							{
								name: 'Named templates',
								desc: `
									<p>You can register a named template in JS, or by specifying <code>name="..."</code> on a <code>&lt;template></code>.</p>
									<p>You can then specify which template to use for a given expression, by prefixing with <code>$name</code>.  You can even specify the inner templates, using a sequence like: <code>$name1$name2{expr}</code>.</p>
								`,
								html: `
									<template name="hulk-says">
										<strong class="hulk">
											<!-- The special expression {=}
											  refers to the current data. -->
											{=}
										</strong>
									</template>
									
									<!-- Use our custom template, and then
									  "uppercase" to render things inside that -->
									$hulk-says$uppercase{message}
								`,
								js: `
									// Register a template from a tagged literal
									Matsui.global.addTag("uppercase")\`
										\${d => d.toUpperCase()}
									\`;

									Matsui.replace(node, {
										message: 'Hello ðŸ‘‹'
									});
								`
							},
							{
								name: 'Custom JS templates',
								desc: `
									<p>The HTML template syntax is helpful, but you don't need to use it.  A template is any JavaScript function which accepts an "inner" template (for rendering children, if needed), and returns an object with:</p>
									<dl>
										<dt><code>node:</code></dt>
										<dd>a DOM node (or <code>DocumentFragment</code>) to be inserted</dd>
										<dt><code>updates: [...]</code></dt>
										<dd>a list of functions taking a <code>data</code> argument and making DOM changes.</dd>
									</dl>
									<p>Matsui takes care of making sure the update functions are only called when the relevant data has changed.  They are always called in order, but some may be skipped.</p>
								`,
								js: `
									function json(innerTemplate) {
										let node = document.createElement('code');
										return {
											node: node,
											updates: [data => {
												node.textContent = JSON.stringify(data);
											}]
										};
									}

									Matsui.replace(node, {foo: 'bar'}, json);
								`
							},
							{
								name: 'Wrapped data',
								desc: `
									<p><code>Matsui.wrap(data)</code> returns an object which lets you make changes, or monitor/update with <a href="https://www.rfc-editor.org/rfc/rfc7386.html">merge values</a>.</p>
									<p><code>Matsui.replace(...)</code> is a shorthand for <code>.wrap(d).replace(...)</code>.</p>
								`,
								html: `
									Check me:
									<input type="checkbox" $value="obj.checked">
									
									<pre id="change-list"></pre>
								`,
								js: `
									let wrapped = Matsui.replace(node, {
										foo: 'bar',
										obj: {checked: false}
									});
									
									// called when relevant (like template fns)
									wrapped.addUpdates(data => {
										if (data.obj.checked) {
											// un-check it after a short delay
											setTimeout(e => {
												data.obj.checked = false;
											}, 500);
										}
									});
									
									// monitor all changes, as merge objects
									wrapped.trackMerges(merge => {
										let line = JSON.stringify(merge) + '\\n';
										changeList.textContent += line;
										changeList.scrollTo(0, 1e10);
									});
								`,
								elements: {changeList: '#change-list'}
							}
						]
					},/*
					{
						label: 'Simple HTML templates',
						examples: [
							{
								name: 'Value substitution',
								desc: '<p>Enclosing a property name in <code>{brackets}</code> will replace it with that property value.</p><p>You can use <code>{dot.separated.properties}</code> to get values from inside objects.</p>',
								html: `
									<strong>Hello, {name}!</strong>
								`,
								js: `
									Matsui.replace(node, {
										name: 'world',
									});
								`,
								elements: {'node': 'strong'}
							},
							{
								name: 'Full expressions',
								desc: '<p>You can wrap a JavaScript data-function inline in the template with <code>${...}</code>.</p><p>Any <code>&lt;script></code>s are scoped to the template, which can help keep your code clean</p>',
								html: `
									<strong>
										Hello, \${d => d.name.toUpperCase()}!
									</strong>
								`,
								js: `
									Matsui.replace(node, {
										name: 'world',
									});
								`
							},
							{
								name: 'Generic attributes',
								desc: `
									<p>Any attribute prefixed with <code>$</code> is processed as a dynamic value.  By default, it will be used as:</p>
									<ol>
										<li>an event, if one exists (by checking for <code>on...</code>)</li>
										<li>an object property on the JS DOM object</li>
										<li>an HTML attribute on the element</li>
									</ol>
									<p>To always assign to the actual attribute, prefix with <code>$-</code> instead.  This also disables name-mangling, which is particularly useful for SVG attributes.</p>
								`,
								html: `
									<button $click="\${d => d.flip = !d.flip}">toggle</button>
									
									<label>
										<!-- this sets the .checked property, not the attribute -->
										<input disabled type="checkbox" $checked="{flip}">
										checkbox
									</label>
								`,
								js: `
									Matsui.replace(node, {
										flip: false
									});
								`
							},
							{
								name: 'Custom JS',
								desc: 'the simplest way to get started'
							}
						]
					}*/
				]
			});
			render.data.groups[0].examples[0].selected = true;
			render.addUpdates(data => {
				if (Matsui.merge.getHidden(data).exampleName) {
					data.groups.forEach(group => group.examples.forEach(example => {
						example.selected = (example.name == data.exampleName);
					}));
				}
			});
			render.syncHash(d => ({
				get query() {
					if (d.linkExampleName == d.exampleName) {
						return {example: d.exampleName};
					}
					d.linkExampleName = null;
					return {};
				},
				set query(query) {
					if (query.example) {
						d.exampleName = d.linkExampleName = query.example;
						document.querySelector('#examples').scrollIntoView();
					}
				}
			}));
			function linkToExample(name) {
				render.data.linkExampleName = render.data.exampleName = name;
			}
		</script>

		<!-- Syntax highlighting with Prism.js -->
		<script defer fetchpriority="low" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js" integrity="sha512-9khQRAUBYEJDCDVP2yw3LRUQvjJ0Pjx0EShmaQjcHa6AXiOv6qHQu9lCAIR8O+/D8FtaCoJ2c0Tf9Xo7hYH01Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
		<script defer fetchpriority="low" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-SkmBfuA2hqjzEVpmnMt/LINrjop3GKWqsuLSSB3e7iBmYK7JuWw4ldmmxwD9mdm2IRTTi0OxSAfEGvgEi0i2Kw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
		<!-- Prism.js default style, but only the tokens -->
		<style>.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style>
	</body>
</html>
