export default Matsui;
(e=>{"undefined"==typeof self&&"object"==typeof module?module.exports=e():self.Matsui=e("function"==typeof Matsui?Matsui:self.Matsui)})(e=>{Object.hasOwn||(Object.hasOwn=(e,t)=>Object.prototype.hasOwnProperty.call(e,t));let t=[],d=e=>e&&"object"==typeof e,h=()=>document.createTextNode("");function n(e,t){for(;e.nextSibling&&e.nextSibling!=t;)e.nextSibling.remove()}function u(){let e=document.createDocumentFragment(),t=h(),r=h();return e.append(t,r),{t:e,l:(...e)=>{n(t,r),t.after(...e)}}}let a=Symbol();function s(t){if(d(t)){let e=t[a];for(;e&&e!=t;)e=(t=e)[a]}return t}let l=Symbol(),o=Symbol(),m=Symbol("no change"),c=Symbol("replace"),y={apply(r,n,l){return d(n)?d(r)?Array.isArray(n)?n:(n[c]&&(l?r[c]=!0:delete n[c]),Object.keys(n).forEach(e=>{var t=n[e];Object.hasOwn(r,e)?null!=t||l?r[e]=y.apply(r[e],t,l):delete r[e]:null==t&&!l||(r[e]=t)}),r):(l&&(n[c]=!0),n):n},make(n,l,e){if(!e||n!==l){if(!d(l))return l;if(!d(n))return l[c]=!0,l;if(Array.isArray(l))return l;let r={};return Object.keys(l).forEach(e=>{var t;Object.hasOwn(n,e)?void 0!==(t=y.make(n[e],l[e],!0))&&(r[e]=t):r[e]=l[e]}),Object.keys(n).forEach(e=>{Object.hasOwn(l,e)||(r[e]=null)}),e&&0==Object.keys(r).length?void 0:r}},tracked(e,t,r){if(!d(e))return e;let n=t,l=!1,o=m,i=null,u=()=>{var e;clearTimeout(i),o!==m&&(e=o,o=m,n(e))},f=(e,l)=>new Proxy(e,{get(e,t){var r=e[t];return t===a?e:d(r)?f(r,e=>l({[t]:e})):r},set(e,t,r,n){if(null==r)return delete n[t];if((r=s(r))===e[t])return!0;if(n=y.make(e[t],r),d(n))n[c]=!0;else if(r===e[t])return!0;return!!Reflect.set(e,t,r)&&(l({[t]:n}),!0)},deleteProperty(e,t){return!(t in e)||delete e[t]&&(l({[t]:null}),!0)}});return f(e,t=e=>{if(o!==m)o=y.apply(o,e,!0);else if(o=e,r)requestAnimationFrame(u),clearTimeout(i),i=setTimeout(u,0);else if(!l)for(;o!==m;)l=!0,u(),l=!1})},addHidden(e,n){return d(e)?new Proxy(e,{get(e,t){var r;return t===l?n:t===o||t===a?e:(e=e[t],r=d(n)&&t in n,y.addHidden(e,r?n[t]:m))},has(e,t){return t===l||t in e}}):e},getHidden(e,t){var r;return d(e)&&void 0!==(r=s(e[l]))?r===m?t:r:e},withoutHidden(e){return d(e)&&e[o]||e}},i=Symbol(),f=Symbol(),p=Symbol("accessed"),v=Symbol("list-keys"),b={tracked(e,n){if(!d(e))return n[p]=p,e;let l=Array.isArray(e);return new Proxy(e,{get(e,t){var r=e[t];return t===a||t===f?e:t===i?(n[p]=p,e):l&&"length"===t?(n[v]=v,r):("function"!=typeof r||r.prototype||(n[p]=p),t in n||(n[t]={}),b.tracked(r,n[t]))},ownKeys(e){return n[v]=v,Reflect.ownKeys(e)}})},pierce(e,t){return e&&e[t?f:i]||e},accessed:p},g=Symbol(),w=(o,r)=>{for(let e=0;e<o.length;++e)o[e][g]&&(o.splice(e,1,...o[e][g]),--e);if(r){let t=w(o);o=[e=>t(r(e))]}Object.freeze(o);let t=!0,i=[],n=null,e=l=>{l=b.pierce(l);let r=y.withoutHidden(l),e=s(r);if(t||n!==e)n=d(e)?e:null,t=!1,o.forEach((e,t)=>{t=i[t]={},e(b.tracked(r,t))});else{let n=y.getHidden(l,m);o.forEach((e,t)=>{var r;!function e(t,r){if(r!==m){if(t[p])return 1;if(!d(r)||Array.isArray(r)||r[c])return 1;if(t[v]){for(var n in r)if(e(t[n]||{},r[n]))return 1}else for(var l in r)if(t[l]&&e(t[l],r[l]))return 1}}(i[t],n)||(r=i[t]={},e(b.tracked(l,r,t)))})}};return e[g]=o,e},_=/\$\{/g;function j(n,l){let o=0;for(var i,u=[];i=_.exec(n);){u.push(n.slice(o,i.index));let e=i.index+2,t=e+1,r;for(;t<n.length;){if("}"==n[t]){var f=n.slice(e,t);try{r=null,new Function("return "+f);break}catch(e){r=e}}++t}if(r)return console.error(r),u.push(`{${r.message}}`),u.join("");u.push(l(n.slice(e,t))),_.lastIndex=o=t+1}return u.push(n.slice(o)),u.join("")}function $(e){let l=e.split(H);for(let n=1;n<l.length;n+=2){let e=l[n],t=e.slice(1,-1);if("{"==e[0])if("="==t)l[n]=()=>e=>e;else{let r=t.split(".");1==r.length?(r=r[0],l[n]=()=>e=>e?.[r]):l[n]=()=>t=>(r.forEach(e=>{t&&"object"==typeof t&&(t=t[e])}),t)}else l[n]=e=>e[t]}return t=>{let e=l.map(e=>"function"==typeof e?e(t):e).filter(e=>""!=e);return 1==e.length?e[0]:e.some(e=>"function"==typeof e)?t=>e.map(e=>"function"==typeof e?e(t):e).join(""):e.join("")}}function O(e){if(/^template$/i.test(e.tagName))return 1;for(var t of e.attributes||[])if("@"==t.name[0])return 1}function E(e){return/^script$/i.test(e.tagName)}function A(e){return e.slice(1).toLowerCase().replace(/-+(.)/g,(e,t)=>t.toUpperCase())}let H=/(\{[a-z0-9_=\.-]+\}|\uF74A[0-9]+\uF74B)/giu,S=/((\$[a-z0-9_-]+)*)(\{([a-z0-9_=\.-]+)\}|\uF74A([0-9]+)\uF74B)/giu,T=Symbol();function F(e){let s=e.content||e,c=[],d={},m=!1,p=(Array.from(s.childNodes).forEach(t=>{if("TEMPLATE"==t.tagName){var r=t.getAttribute("name");if(r){m=!0;let e=e=>null;t.hasAttribute("$filter")&&(e=$(t.getAttribute("$filter"))),d[r]={o:F(t),i:t.getAttribute("@scoped"),u:t[T],m:e},t.remove()}}}),function r(t,u){if(3==t.nodeType){var f=u,l=t.nodeValue;let e,n=0;for(;e=S.exec(l);){let o=l.slice(n,e.index),i=(n=S.lastIndex,e[1].split("$").slice(1)),t=e[4],r=e[5],u=null;if(t){let e="="==t?[]:t.split(".");u=t=>(e.forEach(e=>{t&&"object"==typeof t&&(t=t[e])}),t)}c.push((n,e)=>{let l=u||e[r];if("function"==typeof l)if("template"===i[0])(n=n.extend()).add("template",l),l=e=>e;else if("scoped"===i[0]){n=n.extend();let t=l;n.add("scoped",B(e=>t(e,n))),l=e=>e}return{p:f,v:(e,t,r)=>{o&&e.before(o),r=((n,e,l)=>{let o=e.map(e=>{var t=n.named[e];if(t)return t;let r="Template not found: "+e;return console.error(r),e=>({node:document.createTextNode(r),updates:[]})});return function t(r){if(r>=e.length)return l;let n=o[r];return e=>n(t(r+1))}(0)(n.dynamic)})(n,i,r),e.before(r.node),"function"==typeof l?t.push(w(r.updates,l)):r.updates.forEach(e=>e(l))}}})}if(0<n){let t=l.slice(n),r=t?e=>e.nodeValue=t:e=>e.remove();c.push(e=>({p:f,v:r}))}}else if(1===t.nodeType){if(O(t)&&u.length){if("TEMPLATE"==t.tagName&&t.hasAttribute("name"))throw Error('<template name=""> can only be immediate child');let o=t[T],i=F(t);return c.push((r,n)=>{let l;if(t.getAttribute("@scoped"))l=B(e=>{var t={};return n[o](t,e),i(r,t)});else{let e={};o?n[o](e):e=n,l=i(r,e)}return{p:u,v:(e,t,r)=>{r=l(r),e.replaceWith(r.node),t.push(w(r.updates))}}}),t.replaceWith(h())}if(E(t))return;for(var e of Array.from(t.attributes))((e,r,n)=>{if("$"==r.name[0]){e.removeAttribute(r.name);let m="-"==r.name[1],p=m?r.name.slice(2):A(r.name),t=$(r.value);c.push((s,e)=>{let c=t(e),d="function"==typeof c;return{p:n,v:(r,e,t)=>{let n=null,l,o=d?(...e)=>c(n,...e):c,i;var u,f,a;i=m?e=>{var t=d?o(r):c;null==t?r.removeAttribute(p):r.setAttribute(p,t)}:p in s.attributes?s.attributes[p](r,o,()=>n):(l=d?o:()=>c,u=r,f=p,a=l,"on"+f in u?void u.addEventListener(f,e=>a(e,u)):f in u?e=>{var t=a(u);try{u[f]=t}catch(e){null==t?u.removeAttribute(f):u.setAttribute(f,t)}}:e=>{var t=a(u);null==t&&u.hasAttribute(f)?u.removeAttribute(f):u.getAttribute(f)!=t&&u.setAttribute(f,t)}),e.push(e=>{n=e,i&&i(e),n=y.withoutHidden(b.pierce(e,!0))})}}})}})(t,e,u)}(t.childNodes||[]).forEach((e,t)=>{r(e,u.concat(t))})}(s,[]),{}),v=!1;for(var t of e.attributes||[]){var r;"@"==t.name[0]&&(v=!0,"scoped"!=(r=A(t.name)))&&(p[r]=$(t.value))}return(l,o)=>{var e,t=l;if(m||v)for(var i in l=l.extend(),d){let r=d[i],n=r.u;if(r.i){var u=B(e=>{var t={};return o[n](t,e),r.o(l,t)});l.add(i,u)}else{let e={};n?o[n](e):e=o;var u=r.m(e),f=r.o(l,e);l.add(i,f,u)}}let a=c.map(e=>e(l,o)),r=r=>{let n=s,l=(s=s.cloneNode(!0),[]),o=a.map(e=>{let t=n;return e.p.forEach(e=>t=t.childNodes[e]),t});return a.forEach((e,t)=>{e.v(o[t],l,r)}),{node:n,updates:l}};for(e in p){var n=l.transforms[e];if(!n)throw Error("Unknown transform: "+e);r=n(r,p[e](o),t,l)}return r}}let P=Symbol(),M=new WeakMap,L=/\uF74A!?[0-9]+\uF74B/gu,R=/^\uF74A![0-9]+\uF74B$/gu,k=new class K{attributes={};transforms={};named={};constructor(e){this.#h=e,this.attributes=Object.create(e?e.attributes:null),this.transforms=Object.create(e?e.transforms:null),this.named=Object.create(e?e.named:null),this.dynamic=r=>{let n=u(),l,o,i={};return{node:n.t,updates:[e=>{if(l&&i.filter(e))return o(e);var t=(l=this.getForData(e,i))(r||this.dynamic);o=w(t.updates),n.l(t.node),o(e)}]}}}#h;#g=[];extend(){return new K(this)}add(e,t,r){if("function"!=typeof(t="function"!=typeof t?t&&t.dynamic:t))throw Error("Template not a function");return e&&(this.named[e]=t),r&&this.#g.unshift({m:r,v:t}),this}addElement(e,t,r){return this.add(e,this.fromElement(t),r)}addAll(e){return(e="string"==typeof(e=e||"template")?document.querySelectorAll(e):e).forEach(e=>{let t=e.id||e.getAttribute("name"),r=null;e.hasAttribute("$filter")&&(r=$(e.getAttribute("$filter"))(null)),"TEMPLATE"===e.tagName&&t&&this.addElement(t,e,r)}),this}addTag(r,n){return(e,...t)=>{e=this.fromTag(e,...t),this.add(r,e,n)}}addScoped(e,t,r){this.add(e,B(t),r)}getForData(t,r){for(let e=0;e<this.#g.length;++e){var n=this.#g[e];if(n.m(t))return r&&(r.filter=n.m),n.v}if(this.#h)return this.#h.getForData(t,r);throw Error("No template for data")}fromElement(i){if("string"==typeof i){var e=document.querySelector(i);if(!e)throw Error("Invalid element:"+i);i=e}if(!i[P]){let f=0,a=e=>"\uf74a"+(e?"!":"")+ ++f+"\uf74b",s="__matsui_template",c={},d=[],e,t,r=i.content||i,n=(function t(r,e){function n(e){var t=a();return c[t]=s+`[${f}]=(${e});`,t}if(3===r.nodeType){var l=f,o=j(r.nodeValue,n);f>l&&(r.nodeValue=o)}else if(1===r.nodeType)if(E(r))11==r.getRootNode().nodeType&&(l=a(!0),c[l]=r.textContent,r.textContent=l,d.push(r));else if(o=e=>{for(var t of r.attributes)"$"!=t.name[0]&&"@"!=t.name[0]||(t.value=j(t.value,n))},O(r)&&!e){var l=a(!0),e=++f+"",i=a(!0),u=(r[T]=e,r.before(document.createTextNode(l)),(u=r.getAttribute("@scoped"))?`(${s},${u})`:s);c[l]=s+`[${e}]=${u}=>{`,o(),t(r.content||r,!0),r.after(document.createTextNode(i)),c[i]="};"}else{o();let e=r.firstChild;for(;e;)t(e),e=e.nextSibling}else{let e=r.firstChild;for(;e;)t(e),e=e.nextSibling}}(r,!0),i.getAttribute("@scoped")),l=e=>e,o=(Object.keys(c).length&&(e=n?s+","+n:s,t="/*"+i.outerHTML.replace(/\*\//g,"* /").replace(L,e=>`*/${c[e]}/*`)+"*/",l=new Function(e,t)),d.forEach(e=>e.remove()),function t(r){var e=E(r)?r.textContent:r.nodeValue;if(R.test(e))r.remove();else{let e=r.firstChild;for(;e;){var n=e.nextSibling;t(e),e=n}/^template$/i.test(r.tagName)&&t(r.content)}}(r),F(i));i[P]=r=>{var e;return n?B(e=>{var t={};return l(t,e),o(r,t)}):(e={},l(e),o(r,e))}}return i[P](this)}fromTag(t,...r){let e=M.get(t);if(!e){var n=[t[0]];for(let e=0;e<r.length;++e)n.push("\uf74a"+e+"\uf74b"),n.push(t[e+1]);var l=document.createElement("template");l.innerHTML=n.join(""),e=F(l),M.set(t,e)}var o={};for(let e=0;e<r.length;++e)o[e]=r[e];return e(this,o)}},x=(k.add("json",e=>{let t=h();return{node:t,updates:[e=>{t.nodeValue=JSON.stringify(e)}]}},e=>!0),k.add("text",e=>{let t=h();return{node:t,updates:[e=>{t.nodeValue=null==e?"":e}]}},e=>!d(e)),k.add("list",i=>{let e=document.createDocumentFragment(),u=[h()];e.appendChild(u[0]);let f,a,s=()=>{var e=u[u.length-2],t=u.pop();n(e,t),t.remove()},c=()=>{for(;1<u.length;)s();f=null,a=null};return{node:e,updates:[r=>{r=b.pierce(r);let n=y.getHidden(r,m);if(n!==m)if(d(r)){if(Array.isArray(r))f&&!a||(c(),f=[]);else{var t=Object.keys(r);if(r=t.map(e=>r[e]),f&&a){let e=0;for(;e<a.length&&t[e]==a[e];)++e;for(;f.length>e;)s(),f.pop()}else c(),f=[];a=t}for(;f.length>r.length;)s(),f.pop();for(f.forEach((e,t)=>{(a?a[t]:t)in n&&e(r[t])});f.length<r.length;){var e=f.length,l=i(i),o=void 0,o=(o=h(),u[u.length-1].after(o),u.push(o),o.before(l.node),w(l.updates));f.push(o),o(r[e])}}else c()}]}}),k.transforms.data=(t,r,e)=>{if("function"!=typeof(r=""==r?e=>e:r))throw Error("needs a data-function argument");return e=>((e=t(e)).updates=[w(e.updates,r)],e)},k.transforms.foreach=(r,e,t)=>{let n=t.named.list;return k.transforms.data(t=>n(e=>r(t)),e,t)},Symbol());function B(l){return t=>{let r,n=u();return{node:n.t,updates:[e=>{e=y.withoutHidden(b.pierce(e,!0)),e=l(e)(t),n.l(e.node),r=w(e.updates)},e=>r(e)]}}}function r(n,t){let l,o=[],i=(t,r)=>{o.forEach(e=>{r&&!e._||e.v(t)})},u=(this.trackMerges=(e,t)=>(o.push({v:e,_:!!t}),this),this.addUpdates=(e,t)=>{let r=w([].concat(e));this.trackMerges(e=>{e=y.addHidden(l,e),r(e)},t),r(l)},e=>{n=e,l=y.tracked(n,i,!t)}),f=(u(n),Object.defineProperty(this,"data",{get(){return l},set(e){var t=y.make(n,e);d(t)&&(t[c]=!0),u(e),i(t,!0),d(t)&&delete t[c]}}),this.merge=(e,t)=>{var r=y.apply(n,e);r!==n&&u(r),i(e,!t)},(e,t,r,n)=>{if(!(e="string"==typeof e?document.querySelector(e):e))throw Error("invalid host");"string"==typeof t&&(t=(t=document.querySelector(t))&&k.fromElement(t)),r||"function"==typeof t||(r=t,t=null),r=r||k,t=(t=t||r.fromElement(e))(r.dynamic),this.addUpdates(t.updates,!0),r=t.node,n?e!==r&&e.replaceWith(r):e.append(r)});this.addTo=(e,t,r)=>(f(e,t,r,!1),this),this.replace=(e,t,r)=>(f(e,t,r,!0),this)}k.transforms.if=(o,i,e)=>(e[x]=i,r=>{let n=u(),l=null;return{node:n.t,updates:[e=>{var t;i(e)?(l||(t=o(r),n.l(t.node),l=w(t.updates)))(e):l&&(n.l(),l=null)}]}}),k.transforms.else=(e,t,r)=>{let n=r[x];if(n)return e=k.transforms.if(e,e=>!n(e),r),delete r[x],e;throw Error("@else must follow @if")},t=new r(t,!0);let z={merge:y,access:b,combineUpdates:w,getRaw:s,global:k,scoped:B,errors:t,Wrapped:r,wrap(e,t){return new r(e,t)},addTo(e,t,r){return z.wrap(t).addTo(e,r)},replace(e,t,r){return z.wrap(t).replace(e,r)}};return e&&setTimeout(e.bind(self,Matsui=z),0),z}),Matsui.version="0.1.1";
//# sourceMappingURL=matsui.mjs.map