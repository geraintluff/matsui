export default Matsui;
"use strict";self.Matsui=(()=>{Object.hasOwn||(Object.hasOwn=(e,t)=>Object.prototype.hasOwnProperty.call(e,t));var e=[];let d=e=>e&&"object"==typeof e,h=()=>document.createTextNode("");function n(e,t){for(;e.nextSibling&&e.nextSibling!=t;)e.nextSibling.remove()}function u(){var e=document.createDocumentFragment();let t=h(),r=h();return e.append(t,r),{t:e,l:(...e)=>{n(t,r),t.after(...e)}}}let a=Symbol();function s(t){if(d(t)){let e=t[a];for(;e&&e!=t;)e=(t=e)[a]}return t}let l=Symbol(),i=Symbol(),m=Symbol("no change"),c=Symbol("replace"),y={apply(r,n,l){return d(n)?d(r)?Array.isArray(n)?n:(n[c]&&(l?r[c]=!0:delete n[c]),Object.keys(n).forEach(e=>{var t=n[e];Object.hasOwn(r,e)?null!=t||l?r[e]=y.apply(r[e],t,l):delete r[e]:null==t&&!l||(r[e]=t)}),r):(l&&(n[c]=!0),n):n},make(n,l,e){if(!e||n!==l){if(!d(l))return l;if(!d(n))return l[c]=!0,l;if(Array.isArray(l))return l;let r={};return Object.keys(l).forEach(e=>{var t;Object.hasOwn(n,e)?void 0!==(t=y.make(n[e],l[e],!0))&&(r[e]=t):r[e]=l[e]}),Object.keys(n).forEach(e=>{Object.hasOwn(l,e)||(r[e]=null)}),e&&0==Object.keys(r).length?void 0:r}},tracked(e,t,r){if(!d(e))return e;let n=t,l=!1,i=m,o=null,u=()=>{var e;clearTimeout(o),i!=m&&(e=i,i=m,n(e))},f=(e,l)=>new Proxy(e,{get(e,t){var r=e[t];return t==a?e:d(r)?f(r,e=>l({[t]:e})):r},set(e,t,r,n){if(null==r)return delete n[t];if((r=s(r))===e[t])return!0;if(n=y.make(e[t],r),d(n))n[c]=!0;else if(r===e[t])return!0;return!!Reflect.set(e,t,r)&&(l({[t]:n}),!0)},deleteProperty(e,t){return!(t in e)||delete e[t]&&(l({[t]:null}),!0)}});return f(e,t=e=>{if(i!=m)i=y.apply(i,e,!0);else if(i=e,r)requestAnimationFrame(u),clearTimeout(o),o=setTimeout(u,0);else if(!l)for(;i!=m;)l=!0,u(),l=!1})},addHidden(e,n){return d(e)?new Proxy(e,{get(e,t){var r;return t==l?n:t==i||t==a?e:(e=e[t],r=d(n)&&t in n,y.addHidden(e,r?n[t]:m))},has(e,t){return t==l||t in e}}):e},getHidden(e,t){var r;return d(e)&&void 0!==(r=s(e[l]))?r===m?t:r:e},withoutHidden(e){return d(e)&&e[i]||e}},o=Symbol(),f=Symbol(),v=Symbol("accessed"),p=Symbol("list-keys"),b={tracked(e,n){if(!d(e))return n[v]=v,e;let l=Array.isArray(e);return new Proxy(e,{get(e,t){var r=e[t];return t==a||t==f?e:t==o?(n[v]=v,e):l&&"length"===t?(n[p]=p,r):("function"!=typeof r||r.prototype||(n[v]=v),t in n||(n[t]={}),b.tracked(r,n[t]))},ownKeys(e){return n[p]=p,Reflect.ownKeys(e)}})},pierce(e,t){return e&&e[t?f:o]||e},accessed:v},g=Symbol(),w=(i,r)=>{for(let e=0;e<i.length;++e)i[e][g]&&(i.splice(e,1,...i[e][g]),--e);if(r){let t=w(i);i=[e=>t(r(e))]}Object.freeze(i);let t=!0,o=[],n=null;var e=l=>{l=b.pierce(l);let r=y.withoutHidden(l);var e=s(r);if(t||n!==e)n=d(e)?e:null,t=!1,i.forEach((e,t)=>{t=o[t]={},e(b.tracked(r,t))});else{let n=y.getHidden(l,m);i.forEach((e,t)=>{var r;!function e(t,r){if(r!=m){if(t[v])return 1;if(!d(r)||Array.isArray(r)||r[c])return 1;if(t[p]){for(var n in r)if(e(t[n]||{},r[n]))return 1}else for(var l in r)if(t[l]&&e(t[l],r[l]))return 1}}(o[t],n)||(r=o[t]={},e(b.tracked(l,r,t)))})}};return e[g]=i,e},_=/\$\{/g;function j(n,l){let i=0;for(var o,u=[];o=_.exec(n);){u.push(n.slice(i,o.index));let e=o.index+2,t=e+1,r;for(;t<n.length;){if("}"==n[t]){var f=n.slice(e,t);try{r=null,new Function("return "+f);break}catch(e){r=e}}++t}if(r)return console.error(r),u.push(`{${r.message}}`),u.join("");u.push(l(n.slice(e,t))),_.lastIndex=i=t+1}return u.push(n.slice(i)),u.join("")}function $(e){let n=e.split(H);for(let e=1;e<n.length;e+=2){var r=n[e];let t=r.slice(1,-1);if("{"==r[0])if("="==t)n[e]=()=>e=>e;else{let r=t.split(".");1==r.length?(r=r[0],n[e]=()=>e=>e?.[r]):n[e]=()=>t=>(r.forEach(e=>{t&&"object"==typeof t&&(t=t[e])}),t)}else n[e]=e=>e[t]}return t=>{let e=n.map(e=>"function"==typeof e?e(t):e).filter(e=>""!=e);return 1==e.length?e[0]:e.some(e=>"function"==typeof e)?t=>e.map(e=>"function"==typeof e?e(t):e).join(""):e.join("")}}function O(e){if(/^template$/i.test(e.tagName))return 1;for(var t of e.attributes||[])if("@"==t.name[0])return 1}function E(e){return/^script$/i.test(e.tagName)}function A(e){return e.slice(1).toLowerCase().replace(/-+(.)/g,(e,t)=>t.toUpperCase())}let H=/(\{[a-z0-9_=\.-]+\}|\uF74A[0-9]+\uF74B)/giu,S=/((\$[a-z0-9_-]+)*)(\{([a-z0-9_=\.-]+)\}|\uF74A([0-9]+)\uF74B)/giu,T=Symbol();function F(e){let s=e.content||e,c=[],d={},m=!1,v=(Array.from(s.childNodes).forEach(t=>{if("TEMPLATE"==t.tagName){var r=t.getAttribute("name");if(r){m=!0;let e=e=>null;t.hasAttribute("$filter")&&(e=$(t.getAttribute("$filter"))),d[r]={i:F(t),o:t.getAttribute("@scoped"),u:t[T],m:e},t.remove()}}}),function r(t,u){if(3==t.nodeType){var f=u,l=t.nodeValue;let e,n=0;for(;e=S.exec(l);){let i=l.slice(n,e.index),o=(n=S.lastIndex,e[1].split("$").slice(1)),t=e[4],r=e[5],u=null;if(t){let e="="==t?[]:t.split(".");u=t=>(e.forEach(e=>{t&&"object"==typeof t&&(t=t[e])}),t)}c.push((n,e)=>{let l=u||e[r];if("function"==typeof l)if("template"===o[0])(n=n.extend()).add("template",l),l=e=>e;else if("scoped"===o[0]){n=n.extend();let t=l;n.add("scoped",B(e=>t(e,n))),l=e=>e}return{v:f,p:(e,t,r)=>{i&&e.before(i),r=function(n,e,l){let i=e.map(e=>{var t=n.named[e];if(t)return t;let r="Template not found: "+e;return console.error(r),e=>({node:document.createTextNode(r),updates:[]})});return function t(r){if(r>=e.length)return l;let n=i[r];return e=>n(t(r+1))}(0)(n.dynamic)}(n,o,r),e.before(r.node),"function"==typeof l?t.push(w(r.updates,l)):r.updates.forEach(e=>e(l))}}})}if(0<n){let t=l.slice(n),r=t?e=>e.nodeValue=t:e=>e.remove();c.push(e=>({v:f,p:r}))}}else if(1===t.nodeType){if(O(t)&&u.length){if("TEMPLATE"==t.tagName&&t.hasAttribute("name"))throw Error('<template name=""> can only be immediate child');let i=t[T],o=F(t);return c.push((r,n)=>{let l;if(t.getAttribute("@scoped"))l=B(e=>{var t={};return n[i](t,e),o(r,t)});else{let e={};i?n[i](e):e=n,l=o(r,e)}return{v:u,p:(e,t,r)=>{r=l(r),e.replaceWith(r.node),t.push(w(r.updates))}}}),t.replaceWith(h())}if(E(t))return;for(var e of Array.from(t.attributes))!function(e,r,n){if("$"==r.name[0]){e.removeAttribute(r.name);let m="-"==r.name[1],v=m?r.name.slice(2):A(r.name),t=$(r.value);c.push((s,e)=>{let c=t(e),d="function"==typeof c;return{v:n,p:(r,e,t)=>{let n=null;var l,i,o,u;let f=d?(...e)=>c(n,...e):c,a;a=m?e=>{var t=d?f(r):c;null==t?r.removeAttribute(v):r.setAttribute(v,t)}:v in s.attributes?s.attributes[v](r,f,()=>n):(l=d?f:()=>c,i=r,o=v,u=l,"on"+o in i?void i.addEventListener(o,e=>u(e,i)):o in i?e=>{var t=u(i);try{i[o]=t}catch(e){null==t?i.removeAttribute(o):i.setAttribute(o,t)}}:e=>{var t=u(i);null==t&&i.hasAttribute(o)?i.removeAttribute(o):i.getAttribute(o)!=t&&i.setAttribute(o,t)}),e.push(e=>{n=e,a&&a(e),n=y.withoutHidden(b.pierce(e,!0))})}}})}}(t,e,u)}(t.childNodes||[]).forEach((e,t)=>{r(e,u.concat(t))})}(s,[]),{}),p=!1;for(var t of e.attributes||[]){var r;"@"==t.name[0]&&(p=!0,"scoped"!=(r=A(t.name)))&&(v[r]=$(t.value))}return(l,i)=>{var e,t=l;if(m||p)for(var o in l=l.extend(),d){let r=d[o],n=r.u;if(r.o){var u=B(e=>{var t={};return i[n](t,e),r.i(l,t)});l.add(o,u)}else{let e={};n?i[n](e):e=i;var u=r.m(e),f=r.i(l,e);l.add(o,f,u)}}let a=c.map(e=>e(l,i)),r=r=>{let n=s,l=(s=s.cloneNode(!0),[]),i=a.map(e=>{let t=n;return e.v.forEach(e=>t=t.childNodes[e]),t});return a.forEach((e,t)=>{e.p(i[t],l,r)}),{node:n,updates:l}};for(e in v){var n=l.transforms[e];if(!n)throw Error("Unknown transform: "+e);r=n(r,v[e](i),t,l)}return r}}let P=Symbol(),k=new WeakMap,L=/\uF74A!?[0-9]+\uF74B/gu,R=/^\uF74A![0-9]+\uF74B$/gu,x=new class t{attributes={};transforms={};named={};constructor(e){this.#h=e,this.attributes=Object.create(e?e.attributes:null),this.transforms=Object.create(e?e.transforms:null),this.named=Object.create(e?e.named:null),this.dynamic=r=>{let n=u(),l,i,o={};return{node:n.t,updates:[e=>{if(l&&o.filter(e))return i(e);var t=(l=this.getForData(e,o))(r||this.dynamic);i=w(t.updates),n.l(t.node),i(e)}]}}}#h;#g=[];extend(){return new t(this)}add(e,t,r){if("function"!=typeof(t="function"!=typeof t?t&&t.dynamic:t))throw Error("Template not a function");return e&&(this.named[e]=t),r&&this.#g.unshift({m:r,p:t}),this}addElement(e,t,r){return this.add(e,this.fromElement(t),r)}addAll(e){return(e="string"==typeof(e=e||"template")?document.querySelectorAll(e):e).forEach(e=>{var t=e.id||e.getAttribute("name");let r=null;e.hasAttribute("$filter")&&(r=$(e.getAttribute("$filter"))(null)),"TEMPLATE"===e.tagName&&t&&this.addElement(t,e,r)}),this}addTag(r,n){return(e,...t)=>{e=this.fromTag(e,...t),this.add(r,e,n)}}addScoped(e,t,r){this.add(e,B(t),r)}getForData(t,r){for(let e=0;e<this.#g.length;++e){var n=this.#g[e];if(n.m(t))return r&&(r.filter=n.m),n.p}if(this.#h)return this.#h.getForData(t,r);throw Error("No template for data")}fromElement(e){if("string"==typeof e){if(!(o=document.querySelector(e)))throw Error("Invalid element:"+e);e=o}if(!e[P]){let f=0,a=e=>"\uf74a"+(e?"!":"")+ ++f+"\uf74b",s="__matsui_template",c={},d=[];var r,i,o;!function t(r,e){function n(e){var t=a();return c[t]=s+`[${f}]=(${e});`,t}if(3===r.nodeType){var l=f,i=j(r.nodeValue,n);f>l&&(r.nodeValue=i)}else if(1===r.nodeType)if(E(r))11==r.getRootNode().nodeType&&(l=a(!0),c[l]=r.textContent,r.textContent=l,d.push(r));else if(i=e=>{for(var t of r.attributes)"$"!=t.name[0]&&"@"!=t.name[0]||(t.value=j(t.value,n))},O(r)&&!e){var l=a(!0),e=++f+"",o=a(!0),u=(r[T]=e,r.before(document.createTextNode(l)),(u=r.getAttribute("@scoped"))?`(${s},${u})`:s);c[l]=s+`[${e}]=${u}=>{`,i(),t(r.content||r,!0),r.after(document.createTextNode(o)),c[o]="};"}else{i();let e=r.firstChild;for(;e;)t(e),e=e.nextSibling}else{let e=r.firstChild;for(;e;)t(e),e=e.nextSibling}}(o=e.content||e,!0);let t=e.getAttribute("@scoped"),n=e=>e,l=(Object.keys(c).length&&(r=t?s+","+t:s,i="/*"+e.outerHTML.replace(/\*\//g,"* /").replace(L,e=>`*/${c[e]}/*`)+"*/",n=new Function(r,i)),d.forEach(e=>e.remove()),function t(r){var e=E(r)?r.textContent:r.nodeValue;if(R.test(e))r.remove();else{let e=r.firstChild;for(;e;){var n=e.nextSibling;t(e),e=n}/^template$/i.test(r.tagName)&&t(r.content)}}(o),F(e));e[P]=r=>{var e;return t?B(e=>{var t={};return n(t,e),l(r,t)}):(e={},n(e),l(r,e))}}return e[P](this)}fromTag(t,...r){let e=k.get(t);if(!e){var n=[t[0]];for(let e=0;e<r.length;++e)n.push("\uf74a"+e+"\uf74b"),n.push(t[e+1]);var l=document.createElement("template");l.innerHTML=n.join(""),e=F(l),k.set(t,e)}var i={};for(let e=0;e<r.length;++e)i[e]=r[e];return e(this,i)}},M=(x.add("json",e=>{let t=h();return{node:t,updates:[e=>{t.nodeValue=JSON.stringify(e)}]}},e=>!0),x.add("text",e=>{let t=h();return{node:t,updates:[e=>{t.nodeValue=null==e?"":e}]}},e=>!d(e)),x.add("list",o=>{var e=document.createDocumentFragment();let u=[h()];e.appendChild(u[0]);let f,a,s=()=>{var e=u[u.length-2],t=u.pop();n(e,t),t.remove()},c=()=>{for(;1<u.length;)s();f=null,a=null};return{node:e,updates:[r=>{r=b.pierce(r);let n=y.getHidden(r,m);if(n!==m)if(d(r)){if(Array.isArray(r))f&&!a||(c(),f=[]);else{var t=Object.keys(r);if(r=t.map(e=>r[e]),f&&a){let e=0;for(;e<a.length&&t[e]==a[e];)++e;for(;f.length>e;)s(),f.pop()}else c(),f=[];a=t}for(;f.length>r.length;)s(),f.pop();for(f.forEach((e,t)=>{(a?a[t]:t)in n&&e(r[t])});f.length<r.length;){var e=f.length,l=o(o),i=void 0,i=(i=h(),u[u.length-1].after(i),u.push(i),i.before(l.node),w(l.updates));f.push(i),i(r[e])}}else c()}]}}),x.transforms.data=(t,r,e)=>{if("function"!=typeof(r=""==r?e=>e:r))throw Error("needs a data-function argument");return e=>((e=t(e)).updates=[w(e.updates,r)],e)},x.transforms.foreach=(r,e,t)=>{let n=t.named.list;return x.transforms.data(t=>n(e=>r(t)),e,t)},Symbol());function B(l){return t=>{let r,n=u();return{node:n.t,updates:[e=>{e=y.withoutHidden(b.pierce(e,!0)),e=l(e)(t),n.l(e.node),r=w(e.updates)},e=>r(e)]}}}function r(n,t){let l,i=[],o=(t,r)=>{i.forEach(e=>{r&&!e._||e.p(t)})},u=(this.trackMerges=(e,t)=>(i.push({p:e,_:!!t}),this),this.addUpdates=(e,t)=>{let r=w([].concat(e));this.trackMerges(e=>{e=y.addHidden(l,e),r(e)},t),r(l)},e=>{n=e,l=y.tracked(n,o,!t)}),f=(u(n),Object.defineProperty(this,"data",{get(){return l},set(e){var t=y.make(n,e);d(t)&&(t[c]=!0),u(e),o(t,!0),d(t)&&delete t[c]}}),this.merge=(e,t)=>{var r=y.apply(n,e);r!==n&&u(r),o(e,!t)},(e,t,r,n)=>{if(!(e="string"==typeof e?document.querySelector(e):e))throw Error("invalid host");"string"==typeof t&&(t=(t=document.querySelector(t))&&x.fromElement(t)),r||"function"==typeof t||(r=t,t=null),r=r||x,t=(t=t||r.fromElement(e))(r.dynamic),this.addUpdates(t.updates),r=t.node,n?e!==r&&e.replaceWith(r):e.append(r)});this.addTo=(e,t,r)=>(f(e,t,r,!1),this),this.replace=(e,t,r)=>(f(e,t,r,!0),this)}x.transforms.if=(i,o,e)=>(e[M]=o,r=>{let n=u(),l=null;return{node:n.t,updates:[e=>{var t;o(e)?(l||(t=i(r),n.l(t.node),l=w(t.updates)))(e):l&&(n.l(),l=null)}]}}),x.transforms.else=(e,t,r)=>{let n=r[M];if(n)return e=x.transforms.if(e,e=>!n(e),r),delete r[M],e;throw Error("@else must follow @if")},e=new r(e,!0);let z={merge:y,access:b,combineUpdates:w,getRaw:s,global:x,scoped:B,errors:e,Wrapped:r,wrap(e,t){return new r(e,t)},addTo:(e,t,r)=>z.wrap(t).addTo(e,r),replace:(e,t,r)=>z.wrap(t).replace(e,r)};return z})(),Matsui.version="0.1.0";
//# sourceMappingURL=matsui.mjs.map